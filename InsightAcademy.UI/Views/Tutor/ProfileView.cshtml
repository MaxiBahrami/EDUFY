@using InsightAcademy.ApplicationLayer.IService
@using InsightAcademy.InfrastructureLayer.Data.Seed
@using InsightAcademy.UI.Helper
@using InsightAcademy.UI.Hubs
@inject IGeoService _geoService;
@model Tutor
@{
    ViewData["Title"] = "ProfileView";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var timeZones = ViewBag.ZonesList as List<string>;
}


<style>
    .filter-container {
        display: flex;
        margin-top: 5px;
        justify-content: center;
        align-items: center;
        gap: 20px; /* Adjust the gap between the dropdowns as needed */
        margin-bottom: 20px; /* Space below the filter container */
    }

        .filter-container label {
            margin-right: 10px; /* Space between label and dropdown */
        }
</style>
<main class="tu-main tu-bgmain">
    <section class="tu-main-section">
        <div class="container">
            <div class="row gy-4">
                <div class="col-xl-8 col-xxl-9">
                    <div class="tu-tutorprofilewrapp">
                        @if (User.Identity.IsAuthenticated)
                        {
                            @if (Model != null)
                            {
                                bool hasBookmarked = Model.WishLists.Any(l => l.ApplicationUserId == User.GetUserId() && l.TutorId == Model.Id);
                                @if (hasBookmarked)
                                {
                                    <span class="tu-cardtagSave" onclick="deleteWishList('@Model.Id')">

                                        <span class="bi bi-bookmark-fill"></span>
                                    </span>
                                }
                                else
                                {
                                    <span class="tu-cardtag" style="color: red !important;" onclick="addToWishList('@Model.Id')">
                                        <!-- Bookmark icon when item is in wishlist -->
                                        <span class="bi bi-bookmark-fill"></span>
                                    </span>
                                }
                            }

                        }
                        <div class="tu-profileview">
                            <figure>
                                <img src="/@(Model.ApplicationUser.ProfileImageUrl == "images/login/woman.png" || (Model.ApplicationUser.ProfileImageUrl == "images/login/man.png") ? "images/noimage.png" : Model.ApplicationUser.ProfileImageUrl)" width="67%" height="70" alt="image">
                            </figure>
                            <div class="tu-protutorinfo">
                                <div class="tu-protutordetail">
                                    <div class="tu-productorder-content">
                                        <figure>
                                            <img src="/@Model.ApplicationUser.ProfileImageUrl" alt="images">
                                        </figure>
                                        <div class="tu-product-title">
                                            <h3>@(Model.FirstName + " " + Model.LastName)  <i class="icon icon-check-circle tu-greenclr" data-tippy-trigger="mouseenter" data-tippy-html="#tu-verifed" data-tippy-interactive="true" data-tippy-placement="top"></i></h3>

                                            <h5>@Model.Tagline</h5>
                                        </div>
                                        <div class="tu-listinginfo_price">
                                            <span>1 hour session:</span>
                                            <h4>$@Model.HourlyRate/hr</h4>
                                        </div>
                                    </div>
                                    <ul class="tu-tutorreview">
                                        <li>

                                            <span onmouseover="showRatingBreakDown('@Model.Id','@AppHelper.CalculateAverageRating(Model.Reviews.Sum(r => r.Rating), Model.Reviews.Count())')">@string.Format("{0:F1}", @AppHelper.CalculateAverageRating(Model.Reviews.Sum(r => r.Rating), Model.Reviews.Count()))<i class="fa fa-star tu-coloryellow"> <em>@Model.Reviews.Count()</em> </i> </span>
                                        </li>
                                        <li>
                                            <span><i class="fa fa-check-circle tu-colorgreen"><em>0%</em></i><em>Job compeletion</em></span>
                                        </li>
                                        <li>
                                            @{
                                                var city = !string.IsNullOrEmpty(Model.City) ? await _geoService.GetCityById(Convert.ToInt32(Model.City)) : null;
                                                var cityName = city?.Name ?? "";
                                                var country = !string.IsNullOrEmpty(Model.Country) ? await _geoService.GetCountryById(Convert.ToInt32(Model.Country)) : null;
                                                var countryName = country?.Name ?? "";

                                            }
                                            <span><i class="icon icon-map-pin"><span>@cityName, @countryName</span></i></span>
                                        </li>
                                    </ul>
                                    <div class="tu-detailitem">
                                        <h6>Languages I know</h6>
                                        <div class="tu-languagelist">
                                            <ul class="tu-languages">
                                                @{
                                                    if (!string.IsNullOrEmpty(Model.Language))
                                                    {
                                                        var langusges = Model.Language.Split(',');

                                                        foreach (var language in langusges)
                                                        {
                                                                                        <li>@language</li>

                                                        }
                                                    }
                                                }

                                                @*  <li><a class="tu-showmore tu-tippytooltip" href="javascript:void(0);" data-tippy-trigger="click" data-tippy-html="#tu-industrypro" data-tippy-interactive="true">+02 more</a></li> *@
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tu-actionbts">
                            <div class="tu-userurl">
                                <i class="icon icon-globe"></i>
                                @{
                                    string websiteUrl = Model?.Contact?.Website;
                                    // Check if the URL starts with "http://" or "https://", if not, prepend "http://"
                                    if (!string.IsNullOrWhiteSpace(websiteUrl) && !websiteUrl.StartsWith("http://") && !websiteUrl.StartsWith("https://"))
                                    {
                                        websiteUrl = "http://" + websiteUrl;
                                    }
                                }
                                <a href="@websiteUrl" target="_blank">@Model?.Contact?.Website <i class="icon icon-copy"></i></a>
                            </div>
                            <ul class="tu-profilelinksbtn">
                                @*   <li>
                                <a class="tu-linkheart" href="javascript:void(0);"><i class="icon icon-heart"></i><span>Save</span></a>
                                </li> *@
                                <li>
                                    @{
                                        bool hasLiked = Model.Likes.Any(l => l.ApplicationUserId == User.GetUserId() && l.TutorId == Model.Id);
                                                                    @if (hasLiked)
                                        {

                                                                        <i onclick="deleteLike('@Model.Id')" class="icon icon-heart tu-colorred"></i>

                                                                        <span>Liked</span>
                                        }
                                        else
                                        {
                                                                        <i class="icon icon-heart"></i>

                                                                        <span onclick="addToLike('@Model.Id')">Like</span>
                                        }
                                    }

                                </li>
                                @{
                                    bool disableButton = false;
                                    if (User.Identity.IsAuthenticated)
                                    {
                                        var userId = User.GetUserId();
                                        if (userId == Model.ApplicationUserId)
                                        {
                                            disableButton = true;
                                        }
                                    }
                                }
                                <li><button type="button" @(disableButton ? "disabled" : "") class="tu-secbtn" onclick="openChatPopup('@Model.ApplicationUserId','@Model.ApplicationUser.ProfileImageUrl','@Model.FullName')">Let’s talk now</button></li>
                                <li>
                                    <a href="javascript:void(0)" onclick="openSchedular('@Model.Id','@Model.FullName')" class="tu-primbtn">Book a tution</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="tu-detailstabs">
                        <ul class="nav nav-tabs tu-nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true"><i class="icon icon-home"></i><span>Introduction</span></button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false"><i class="icon icon-message-circle"></i><span>Reviews</span></button>
                            </li>
                        </ul>
                        <div class="tab-content tu-tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                <div class="tu-tabswrapper">
                                    <div class="tu-tabstitle">
                                        <h4>A brief introduction</h4>
                                    </div>
                                    <div class="tu-description">
                                        <p>
                                            @Html.Raw(Model.Introduction)
                                        </p>
                                    </div>
                                    @*   <div class="tu-blogfeatures">
                                    <div class="tu-featurelist">
                                    <div class="tu-description">
                                    <p>
                                    Sed ut perspiciatis unde omnis iste natus error sit voluptatem antium doloremque laudantium,
                                    totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto.
                                    </p>
                                    </div>
                                    <ul class="tu-mainlist">
                                    <li>Cupiditate non provident, similique sunt in culpame</li>
                                    <li>Quiofficia deserunt mollitia animi id est laborum etalorum</li>
                                    <li>Et harum quidem rerum facilis expedita</li>
                                    <li>Nam libero tempore cum soluta</li>
                                    </ul>
                                    </div>
                                    </div> *@
                                    @*  <div class="tu-description">
                                    <p>
                                    When our power of choice is untrammelled and when nothing prevents our being able to do what we like best, every pleasure is to be welcomed and every pain avoided.
                                    But in certain circumstances and owing to the claims of duty or the obligations of business it will frequently occur that pleasures have to be repudiated and annoyances accepted. The wise man therefore always holds in these
                                    matters to this principle of selection: he rejects pleasures to secure other greater pleasures, or else he endures pains to avoid worse pains..
                                    </p>
                                    </div> *@
                                </div>

                                <div class="tu-tabswrapper">
                                    <div class="tu-tabstitle">
                                        <h4>Education</h4>
                                    </div>
                                    @foreach (var education in Model.Education)
                                    {
                                        <div class="accordion tu-accordionedu" id="accordionFlushExampleaa">
                                            <div id="tu-edusortable" class="tu-edusortable">
                                                <div class="tu-accordion-item">
                                                    <div class="tu-expwrapper">
                                                        <div class="tu-accordionedu">
                                                            <div class="tu-expinfo">
                                                                <div class="tu-accodion-holder">
                                                                    <h5 class="collapsed" data-bs-toggle="collapse" data-bs-target="#flush-collapseOneba" aria-expanded="true" aria-controls="flush-collapseOneba">@education.Degree</h5>
                                                                    <ul class="tu-branchdetail">
                                                                        <li><i class="icon icon-home"></i><span>@education.University</span></li>
                                                                        <li><i class="icon icon-map-pin"></i><span>@education.Location</span></li>
                                                                        <li><i class="icon icon-calendar"></i><span>@education.StartDate.ToString("MMMM dd") - @(education.EndDate.HasValue ? @education.EndDate.Value.ToString("MMMM dd") : "Present")</span></li>
                                                                    </ul>
                                                                </div>
                                                                <i class="icon icon-plus" role="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOneba" aria-expanded="true" aria-controls="flush-collapseOneba"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="flush-collapseOneba" class="accordion-collapse collapse show" data-bs-parent="#accordionFlushExampleaa">
                                                        <div class="tu-edubodymain">
                                                            <div class="tu-accordioneduc">
                                                                <p>@education.Description</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                @* <div class="tu-accordion-item">
                                            <div id="flush-headingOneaa" class="tu-expwrapper" >
                                            <div class="tu-accordionedu">
                                            <div class="tu-expinfo">
                                            <div class="tu-accodion-holder">
                                            <h5  class="collapsed" data-bs-toggle="collapse" data-bs-target="#flush-collapseOneaa" aria-expanded="false" aria-controls="flush-collapseOneaa">MBBS, MS, Mch neurosurgery</h5>
                                            <ul class="tu-branchdetail">
                                            <li><i class="icon icon-home"></i><span>University of Massachusetts-Amherst</span></li>
                                            <li><i class="icon icon-map-pin"></i><span>Kansas City, LA</span></li>
                                            <li><i class="icon icon-calendar"></i><span>January 2014 - May 2018</span></li>
                                            </ul>
                                            </div>
                                            <i class="icon icon-plus" role="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOneaa" aria-expanded="false" aria-controls="flush-collapseOneaa"></i>
                                            </div>
                                            </div>
                                            </div>
                                            <div id="flush-collapseOneaa" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExampleaa">
                                            <div class="tu-edubodymain">
                                            <div class="tu-accordioneduc">
                                            <p>Accusamus et iusto odio dignissie corrupti quos dolores etolestias excepo officiale deserunt mollitia animi idendication estame laborum.Accusamus etae iusto odioignissie corrupti quos dolores etolestias excepto officiale deserunt mollitia animi endication estame laborum.</p>
                                            </div>
                                            </div>
                                            </div>
                                            </div> *@
                                                @* 	<div class="tu-accordion-item">
                                            <div class="collapsed tu-expwrapper">
                                            <div class="tu-accordionedu">
                                            <div class="tu-expinfo">
                                            <div class="tu-accodion-holder">
                                            <h5 data-bs-toggle="collapse" data-bs-target="#flush-collapseOneca" aria-expanded="false" aria-controls="flush-collapseOneca">MBBS, MD pathology</h5>
                                            <ul class="tu-branchdetail">
                                            <li><i class="icon icon-home"></i><span>Auburn University</span></li>
                                            <li><i class="icon icon-map-pin"></i><span>Atlanta, CO</span></li>
                                            <li><i class="icon icon-calendar"></i><span>April 2011 - December 2013</span></li>
                                            </ul>
                                            </div>
                                            <i class="icon icon-plus" role="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOneca" aria-expanded="false" aria-controls="flush-collapseOneca"></i>
                                            </div>
                                            </div>
                                            </div>
                                            <div id="flush-collapseOneca" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExampleaa">
                                            <div class="tu-edubodymain">
                                            <div class="tu-accordioneduc">
                                            <p>Accusamus et iusto odio dignissie corrupti quos dolores etolestias excepo officiale deserunt mollitia animi idendication estame laborum.Accusamus etae iusto odioignissie corrupti quos dolores etolestias excepto officiale deserunt mollitia animi endication estame laborum.</p>
                                            </div>
                                            </div>
                                            </div>
                                            </div> *@
                                            </div>
                                        </div>
                                    }
                                </div>

                                <div class="tu-tabswrapper">
                                    <div class="tu-tabstitle">
                                        <h4>I can teach</h4>
                                    </div>
                                    <ul class="tu-icanteach">
                                        @foreach (var data in Model.TutorSubject)
                                        {
                                            <li>
                                                <div class="tu-tech-title">
                                                    <h6>@data.Category.Name</h6>
                                                </div>

                                                <ul class="tu-serviceslist">
                                                    @data?.Subject?.Name
                                                    @{
                                                        // if (!string.IsNullOrEmpty(data.su))
                                                        // {
                                                        //     var tags = data.Tags.Split(",");
                                                        //     foreach (var tag in tags)
                                                        //     {
                                                        //         <li>
                                                        //             <a href="/tutor/list?tags=@tag"><b>@tag</b></a>
                                                        //         </li>
                                                        //     }
                                                        // }

                                                    }
                                                </ul>
                                            </li>
                                        }
                                    </ul>
                                </div>
                                <div class="tu-tabswrapper">
                                    <div class="tu-tabstitle">
                                        <h4>Media gallery</h4>
                                    </div>
                                    <div class="tu-slider-holder">
                                        <div id="tu_splide" class="tu-sync splide">
                                            <div class="splide__track">
                                                <ul class="splide__list">
                                                    @foreach (var media in Model.Media)
                                                    {
                                                        if (media.Type == "2")
                                                        {
                                                            <li class="splide__slide">
                                                                <figure class="tu-sync__content">
                                                                    <a class="tu-themegallery" data-vbtype="video" data-gall="gall" href="/@media.Url" data-autoplay="true">
                                                                        <img src="/images/tutordetail/slider/img-02.jpg" alt="Image Description">
                                                                        <span class="tu-servicesvideo"></span>
                                                                    </a>
                                                                </figure>
                                                            </li>
                                                        }
                                                        else
                                                        {
                                                            <li class="splide__slide">
                                                                <figure class="tu-sync__content">
                                                                    <a class="tu-themegallery" data-gall="gall" href="/@media.Url">
                                                                        <img src="/@media.Url" alt="Image Description">
                                                                    </a>
                                                                </figure>
                                                            </li>
                                                        }
                                                    }



                                                </ul>
                                            </div>
                                        </div>
                                        <div id="tu_splidev2" class="tu-syncthumbnail splide">
                                            <div class="splide__track">
                                                <ul class="splide__list">
                                                    @foreach (var media in Model.Media)
                                                    {
                                                        if (media.Type == "2")
                                                        {
                                                            <li class="splide__slide">
                                                                <figure class="tu-syncthumbnail__content">
                                                                    <span class="tu-servicesvideo"></span>
                                                                    <img src="/images/tutordetail/slider/thumbnails/img-02.png" alt="Image Description">
                                                                </figure>
                                                            </li>
                                                        }
                                                        else
                                                        {
                                                            <li class="splide__slide">
                                                                <figure class="tu-syncthumbnail__content">
                                                                    <img src="/@media.Url" alt="Image Description">
                                                                </figure>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                <div class="filter-container">
                                    <label for="ratingFilter">Filter by rating:</label>
                                    <select id="ratingFilter" onchange="filterReviews('@Model.Id')">
                                        <option value="">All ratings</option>
                                        <option value="5">5 stars</option>
                                        <option value="4">4 stars</option>
                                        <option value="3">3 stars</option>
                                        <option value="2">2 stars</option>
                                        <option value="1">1 star</option>
                                    </select>

                                    <label for="sortOrder">Sort by:</label>
                                    <select id="sortOrder" onchange="filterReviews('@Model.Id')">
                                        <option value="">please select order</option>
                                        <option value="desc">Newest first</option>
                                        <option value="asc">Oldest first</option>
                                    </select>
                                </div>
                                <div id="reviews">
                                    <partial name="_Review" model="Model.Reviews" />
                                </div>

                                @if (User.Identity.IsAuthenticated && !User.IsInRole(Roles.Teacher))
                                {
                                    bool hasReviewed = ViewBag.HasReviewed;
                                    if (!hasReviewed)
                                    {
                                        <div class="tu-tabswrapper">
                                            <div class="tu-boxtitle">
                                                <h4>Add your review</h4>
                                            </div>

                                            <fieldset>
                                                <div class="tu-themeform__wrap">
                                                    <div class="form-group-wrap">
                                                        <div class="form-group">
                                                            <div class="tu-reviews">
                                                                <label class="tu-label">Give rating to your review</label>
                                                                <div class="tu-my-ratingholder">
                                                                    <h6>Good experience</h6>
                                                                    <div id="tu-addreview" class="tu-addreview"></div>
                                                                    <input type="hidden" id="rating" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group tu-message-text">
                                                            <label class="tu-label">Review details</label>
                                                            <div class="tu-placeholderholder">
                                                                <textarea class="form-control tu-textarea" id="tu-reviews-content" name="reviews_content" required="" placeholder="Enter description" maxlength="500"></textarea>
                                                                <div class="tu-placeholder">
                                                                    <span>Enter description</span>
                                                                </div>
                                                            </div>
                                                            <div class="tu-input-counter">
                                                                <span>Characters left:</span>
                                                                <b class="tu_current_comment">500</b>
                                                                /                                        <em class="tu_maximum_comment"> 500</em>
                                                            </div>
                                                        </div>

                                                        <div class="form-group tu-formspacebtw">
                                                            <div class="tu-check">
                                                                <input type="hidden" name="termsconditions" value="">
                                                                <input type="checkbox" id="termsconditions" name="termsconditions">
                                                                <label for="termsconditions"><span>I have read and agree to all <a href="javascript:void(0);">Terms &amp; conditions</a></span></label>
                                                            </div>
                                                            <a href="javascript:void(0)" class="tu-primbtn-lg tu-submit-reviews" onclick="addReview('@Model.Id')"><span>Submit</span><i class="icon icon-chevron-right"></i></a>
                                                            <input type="hidden" name="profile_id" value="584">
                                                            <input type="hidden" name="user_id" value="691">
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>

                                        </div>
                                    }

                                }
                            </div>
                        </div>
                    </div>
                    <div class="tu-Joincommunity">
                        <div class="tu-particles">
                            <div id="tu-particlev2"></div>
                        </div>
                        <div class="tu-Joincommunity_content">
                            <h4>Trending tutor directory of 2022</h4>
                            <p>Its Free, Join today and start spreading knowledge with students out there</p>
                        </div>
                        <div class="tu-Joincommunity_btn">
                            <a href="login.html" class="tu-yellowbtn">Join our community</a>
                        </div>
                    </div>
                    @{
                        var relatedTutors = ViewBag.RelatedTeachers as List<Tutor>;
                                                    <div class="tu-explore-title">
                                                        <h3>Explore related tutors</h3>
                                                    </div>
                                                    <div class="tu-explore-content row gy-4">
                                                        @if (relatedTutors != null)
                            {
                                                            @foreach (var tutor in relatedTutors)
                                {
                                                                <div class="col-12 col-md-6 col-lg-4 col-xl-6 col-xxl-4">
                                                                    <div class="tu-featureitem">
                                                                        <figure>
                                                                            <a href="/tutor/Detail?tutorid=@tutor.Id">
                                                                                @if (tutor.Media != null && tutor.Media.Count > 0)
                                                    {
                                                                                    <img src="/@tutor?.Media[0]?.Url" height="46" width="46" alt="image-description">
                                                    }
                                                    else
                                                    {
                                                                                    <img src="/images/noimage.png" height="400" width="612" alt="image-description">
                                                    }

                                                                            </a>
                                                                            <span class="tu-featuretag">FEATURED</span>
                                                                        </figure>
                                                                        <div class="tu-authorinfo">
                                                                            <div class="tu-authordetail">
                                                                                <figure>
                                                                                    <img src="/@tutor.ApplicationUser.ProfileImageUrl" style="width:612; height:400" alt="image-description">
                                                                                </figure>
                                                                                <div class="tu-authorname">
                                                                                    <h5><a href="tutor-detail.html">@tutor.FullName</a> <i class="icon icon-check-circle tu-greenclr" data-tippy-trigger="mouseenter" data-tippy-html="#tu-verifed" data-tippy-interactive="true" data-tippy-placement="top"></i></h5>
                                                                                    <span>@tutor.City, @tutor.Country</span>
                                                                                </div>
                                                                                <ul class="tu-authorlist">
                                                                                    <li>
                                                                                        <span>1 hour session:<em>$@tutor.HourlyRate/hr</em></span>
                                                                                    </li>
                                                                                    <li>
                                                                                        <span>Mobile:<em>@AppHelper.HideText(tutor?.Contact?.PhoneNumber)</em></span>
                                                                                    </li>
                                                                                    <li>
                                                                                        <span>Whatsapp:<em>@AppHelper.HideText(tutor?.Contact?.WhatsappNumber)</em></span>
                                                                                    </li>
                                                                                    @if (@tutor.Education.Count > 0)
                                                        {
                                                                                        <li>
                                                                                            <span>Qualification:<em>@tutor.Education[0].Degree</em></span>
                                                                                        </li>
                                                        }
                                                                                </ul>
                                                                            </div>
                                                                            <div class="tu-instructors_footer">
                                                                                <div class="tu-rating">
                                                                                    <i class="fas fa-star"></i>
                                                                                    <h6>0.0</h6>
                                                                                    <span>(0)</span>
                                                                                </div>
                                                                                <div class="tu-instructors_footer-right">
                                                                                    @if (Model.Likes.Count > 0)
                                                        {
                                                                                        <a onclick="deleteLike('@Model.Id')"><i class="icon icon-heart tu-colorred"></i></a>
                                                        }
                                                        else
                                                        {
                                                                                        <a onclick="addToLike('@Model.Id')"><i class="icon icon-heart "></i></a>
                                                        }

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                }
                            }

                                                    </div>
                    }
                </div>
                <div class="col-xl-4 col-xxl-3">
                    <aside class="tu-asidedetail">
                        <div class="tu-asideinfo text-center">
                            <h6>Hello! You can have my teaching services direct at</h6>
                        </div>
                        <ul class="tu-featureinclude">
                            @if (Model.Services.Contains("MyHome"))
                            {
                                <li>
                                    <span class="icon icon-home tu-colorgreen"> <i>My home</i> </span>
                                    <em class="fa fa-check-circle tu-colorgreen"></em>
                                </li>
                            }
                            @if (Model.Services.Contains("StudentHome"))
                            {
                                <li>
                                    <span class="icon icon-map-pin tu-colorblue"> <i>Student's home</i> </span>
                                    <em class="fa fa-check-circle tu-colorgreen"></em>
                                </li>
                            }
                            @if (Model.Services.Contains("Online"))
                            {
                                <li>
                                    <span class="icon icon-video tu-colororange"> <i>Online</i> </span>
                                    <em class="fa fa-check-circle tu-colorgreen"></em>
                                </li>
                            }
                        </ul>
                        <div class="tu-contactbox">
                            <h6>Contact details</h6>
                            <ul class="tu-listinfo">
                                @if (!string.IsNullOrEmpty(Model?.Contact?.PhoneNumber))
                                {
                                    <li>

                                        <span class="tu-bg-maroon"><i class="icon icon-phone-call "></i></span>
                                        <h6>@AppHelper.HideText(Model?.Contact?.PhoneNumber)</h6>
                                    </li>
                                }
                                @if (!string.IsNullOrEmpty(Model?.Contact?.Email))
                                {
                                    <li>
                                        <span class="tu-bg-voilet"><i class="icon icon-mail"></i></span>
                                        <h6>@AppHelper.HideText(Model?.Contact?.Email)</h6>
                                    </li>
                                }
                                @if (!string.IsNullOrEmpty(Model?.Contact?.SkypeId))
                                {
                                    <li>
                                        <span class="tu-bg-blue"><i class="fab fa-skype"></i></span>
                                        <h6>@AppHelper.HideText(Model?.Contact?.SkypeId)</h6>
                                    </li>
                                }
                                @if (!string.IsNullOrEmpty(Model?.Contact?.WhatsappNumber))
                                {
                                    <li>
                                        <span class="tu-bg-green"><i class="fab fa-whatsapp"></i></span>
                                        <h6>@AppHelper.HideText(Model?.Contact?.WhatsappNumber)</h6>
                                    </li>
                                }
                                @if (!string.IsNullOrEmpty(Model?.Contact?.Website))
                                {
                                    <li>
                                        <span class="tu-bg-orange"><i class="icon icon-printer"></i></span>
                                        <a href="@AppHelper.HideText(Model?.Contact?.Website)" target="_blank">@AppHelper.HideText(Model?.Contact?.Website)</a>
                                    </li>
                                }
                            </ul>
                        </div>
                        <div class="tu-unlockfeature text-center">
                            <h6>
                                Click the button below to buy a package & unlock the contact details
                            </h6>
                            <a href="package.html" class="tu-primbtn tu-btngreen"><span>Unlock feature</span><i class="icon icon-lock"></i></a>
                        </div>
                    </aside>
                </div>
            </div>
        </div>
    </section>
</main>
@* popUp Model *@

<partial name="_ChatBox"></partial>
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Schedule a Meeting with <span id="instructor-name"></span></h4>
                <button type="button" class="close" onclick="closePopup('myModal')">&times;</button>
            
            </div>
            <div class="modal-body">
                <div class="container mt-1">
                    <div class="card mx-auto" >
                        <div class="card-body">
                       
                            <div class="mb-3">
                                
                          
                          
                           
                                    <label for="timezone">Time zone</label>
                            
                                        <select   id="timezone">
                                            @foreach (var timeZone in timeZones)
                                            {
                                                if (timeZone == ViewBag.TimeZone)
                                                {
                                                    <option value="@timeZone" selected="selected">@timeZone</option>
                                                }
                                                else
                                                {
                                                    <option value="@timeZone">@timeZone</option>
                                                }
                                            }
                                        </select>
                                    
                               
                               
                               
                            </div>

                            <div class="mb-3">
                                <label for="date" class="form-label">Select a date</label>
                                <input type="date" class="form-control" id="date" value="2024-09-14" onchange="getSlots(this)">
                            </div>

                            <div class="mb-3">
                                <label for="time" class="form-label">Select time</label>
                                <div id="time-slot" class="btn-group-vertical w-100">
                                    <p>Select a date to view available times</p>
                                    <!-- Add more time slots as needed -->
                                </div>
                            </div>

                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="text-end">
                    <button class="btn btn-secondary me-2" onclick="closePopup('myModal')">Cancel</button>
                    <button class="btn btn-success" id="confirm-btn">Pay By Card</button>
                    <a href="#" id="paypal-confirm-btn" class="tu-primbtn">PayPal</a>
                </div>
            </div>
        </div>

    </div>
</div>
@section Scripts
{
    <script src="/js/vendor/particles.min.js"></script>
    <script src="/js/vendor/venobox.min.js"></script>
    <script src="/js/vendor/lightpick.js"></script>
    <script src="/js/vendor/jRate.js"></script>
    <script src="/js/vendor/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="~/js/wish-list.js"></script>
    <script src="~/js/review.js"></script>
    <script src="~/js/tutor.js"></script>
    <script src="~/js/chat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" integrity="sha512-2ImtlRlf2VVmiGZsjm9bEyhjGW4dU7B6TNwh/hx/iSByxNENtj3WVE6o/9Lj4TJeVXPi4bnOIMXFIJJAeufa0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        $('#timezone').select2({
            placeholder: "Select zone",  // Placeholder text
            allowClear: true,  // Optional: Allow users to clear their selection
            width: '100%'  // Adjust width if necessary
        });
        var openSchedular = function (tutorId,fullName) {
            $.get('/api/check-auth', function (data) {
        if (data.isAuthenticated) {
            $('#myModal').modal('show');
            $('#myModal').data('ID', tutorId);
            $('#instructor-name').text(fullName);
        } else {
            
               window.location.href = '/identity/account/login';
        }
    });
        
        }
        // Helper function to create hourly time slots
        function createHourlySlots(startTime, endTime, container, bookedTimes) {
            var start = new Date(`1970-01-01T${startTime}`);
            var end = new Date(`1970-01-01T${endTime}`);

            // Create 1-hour slots between start and end times
            while (start < end) {
                var nextHour = new Date(start);
                nextHour.setHours(start.getHours() + 1); // Increment by 1 hour

                var isBooked = bookedTimes.some(function (booking) {
                    var bookingStart = new Date(`1970-01-01T${booking.startTime}`);
                    var bookingEnd = new Date(`1970-01-01T${booking.endTime}`);
                    // Check for overlap
                    return (start < bookingEnd && nextHour > bookingStart);
                });

                // Create the button for each time slot only if it's not booked
                if (!isBooked) {
                    var button = document.createElement('button');
                    button.classList.add('btn', 'btn-outline-secondary', 'mb-2');
                    button.textContent = `${formatTime(start)} - ${formatTime(nextHour)}`;

                    // Add click event to highlight the selected slot
                    button.addEventListener('click', (function (btn) {
                        return function () {
                            document.querySelectorAll('#time-slot button').forEach(b => b.classList.remove('active', 'btn-success'));
                            btn.classList.add('active', 'btn-success');
                        };
                    })(button)); // Use a closure to capture the current button

                    // Append the button to the container
                    container.appendChild(button);
                }

                // Move to the next slot
                start = nextHour;
            }
        }


        function formatTime(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var period = hours >= 12 ? 'PM' : 'AM';
            var formattedHour = hours % 12 || 12; // Convert to 12-hour format
            var formattedMinutes = minutes.toString().padStart(2, '0');
            return `${formattedHour}:${formattedMinutes} ${period}`;
        }
        var getSlots = function (date) {
            $.ajax({
                url: '/Tutor/GetTutorSlots',
                type: 'POST',
                data: { date: date.value, tutorId: $('#myModal').data('ID'), studentIANATimeZone: document.getElementById('timezone').value },
                contentype: "application/json",
                success: function (response) {
                    debugger;
                    var scheduleData = response.schedule;
                    console.log(response)
                    // Get the time-slot container
                    var timeSlotContainer = document.getElementById('time-slot');
                    timeSlotContainer.innerHTML = ''; // Clear previous slots

                    // Check if there are any slots returned
                    if (scheduleData.length === 0) {
                        timeSlotContainer.innerHTML = '<p>No available slots for this day.</p>';
                        return;
                    }

                    // Loop through each time slot and create 1-hour intervals
                    scheduleData.forEach(function (slot) {
                        var startTime = slot.startTime;
                        var endTime = slot.endTime;
                        createHourlySlots(startTime, endTime, timeSlotContainer, response.bookedSlots);
                    });
                },
                error: function (xhr, status, error) {
                    if (xhr.status === 401) {
                        // Redirect to login page
                        window.location.href = '/identity/account/login';
                    } else {
                        console.error("Error uploading image: " + error);
                    }
                },
                complete: function () {
                    hideLoader();
                }
            });
        }
        const timeSlots = document.querySelectorAll('#time-slot button');
        timeSlots.forEach(slot => {
            slot.addEventListener('click', function () {
                // Remove 'active' class from all buttons
                timeSlots.forEach(slot => slot.classList.remove('active', 'btn-success'));
                // Add 'active' and 'btn-success' classes to the clicked button
                this.classList.add('active', 'btn-success');
            });
        });

        document.getElementById('confirm-btn').addEventListener('click', function () {
          
            const timezone = document.getElementById('timezone').value;
            const date = document.getElementById('date').value;
            const selectedSlot = document.querySelector('#time-slot button.active');
            const time = selectedSlot ? selectedSlot.textContent : 'No time selected';

            
            if (!selectedSlot)
            {
                showToast('error', "Please select time slot");
                return false;
            }
            showLoader();
         

            $.ajax({
                url: '/Tutor/BookSlot',
                type: 'POST',
                data: { tutorId: $('#myModal').data('ID'), bookingDate: date, slot: time, studentTimeZone: timezone },
                contentype: "application/json",
                success: function (response) {
                   
                    window.location.href = response;
                },
                error: function (xhr, status, error) {
                    if (xhr.status === 401) {
                        // Redirect to login page
                        window.location.href = '/identity/account/login';
                    } else {
                        console.error("Error uploading image: " + error);
                    }
                },
                complete: function () {
                    hideLoader();
                }
            });
        });

        document.getElementById('paypal-confirm-btn').addEventListener('click', function () {

            const timezone = document.getElementById('timezone').value;
            const date = document.getElementById('date').value;
            const selectedSlot = document.querySelector('#time-slot button.active');
            const time = selectedSlot ? selectedSlot.textContent : 'No time selected';


            if (!selectedSlot) {
                showToast('error', "Please select time slot");
                return false;
            }
            showLoader();


            $.ajax({
                url: '/PayPal/CreatePayment',
                type: 'POST',
                data: { tutorId: $('#myModal').data('ID'), bookingDate: date, slot: time, studentTimeZone: timezone },
                contentype: "application/json",
                success: function (response) {

                    window.location.href = response;
                },
                error: function (xhr, status, error) {
                    if (xhr.status === 401) {
                        // Redirect to login page
                        window.location.href = '/identity/account/login';
                    } else {
                        console.error("Error uploading image: " + error);
                    }
                },
                complete: function () {
                    hideLoader();
                }
            });
        });
    </script>

}

